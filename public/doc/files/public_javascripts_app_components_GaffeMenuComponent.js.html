<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>public/javascripts/app/components/GaffeMenuComponent.js - kingkong</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.8.0pr2/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <script src="http://yui.yahooapis.com/combo?3.8.0pr2/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1><a href="../index.html"><img src="../assets/css/kong-header.png" width="389" height="100">kingkong: public/javascripts/app/components/GaffeMenuComponent.js v0.4.0</a></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.4.0</em>
        </div>
    </div>
    <div class="yui3-g">

        <div id="sidebar" class="yui3-u">
            <div id="modules" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Modules</h2>
                </div>
                <div class="bd">
                    <ul>
                    </ul>
                </div>
            </div>
            
            <div id="classes" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Classes</h2>
                </div>
                <div class="bd">
                    <ul>
                            <li><a href="../classes/BigWinComponent.html">BigWinComponent</a></li>
                            <li><a href="../classes/Command.html">Command</a></li>
                            <li><a href="../classes/CommandQueue.html">CommandQueue</a></li>
                            <li><a href="../classes/CustomCommand.html">CustomCommand</a></li>
                            <li><a href="../classes/Dj.html">Dj</a></li>
                            <li><a href="../classes/FireworksCommand.html">FireworksCommand</a></li>
                            <li><a href="../classes/G.BigWinCommand.html">G.BigWinCommand</a></li>
                            <li><a href="../classes/GaffeButton.html">GaffeButton</a></li>
                            <li><a href="../classes/GaffeMenuComponent.html">GaffeMenuComponent</a></li>
                            <li><a href="../classes/Game.html">Game</a></li>
                            <li><a href="../classes/GameComponent.html">GameComponent</a></li>
                            <li><a href="../classes/GameData.html">GameData</a></li>
                            <li><a href="../classes/Main.html">Main</a></li>
                            <li><a href="../classes/MeterComponent.html">MeterComponent</a></li>
                            <li><a href="../classes/ParticlesComponent.html">ParticlesComponent</a></li>
                            <li><a href="../classes/Preloader.html">Preloader</a></li>
                            <li><a href="../classes/QueueFactory.html">QueueFactory</a></li>
                            <li><a href="../classes/Reel.html">Reel</a></li>
                            <li><a href="../classes/ReelsComponent.html">ReelsComponent</a></li>
                            <li><a href="../classes/ServerInterface.html">ServerInterface</a></li>
                            <li><a href="../classes/SignalDispatcher.html">SignalDispatcher</a></li>
                            <li><a href="../classes/SpinEvaluator.html">SpinEvaluator</a></li>
                            <li><a href="../classes/SymbolAnimCommand.html">SymbolAnimCommand</a></li>
                            <li><a href="../classes/SymbolWinsComponent.html">SymbolWinsComponent</a></li>
                            <li><a href="../classes/Utils.html">Utils</a></li>
                            <li><a href="../classes/WinLine.html">WinLine</a></li>
                            <li><a href="../classes/WinLineCommand.html">WinLineCommand</a></li>
                            <li><a href="../classes/WinLinesComponent.html">WinLinesComponent</a></li>
                    </ul>
                </div>
            </div>
            
            
            
            
            
            <div id="fileTree" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Files</h2>
                </div>
                <div class="bd">
                    <ul><li>public/<ul><li>javascripts/<ul><li>app/<ul><li><a href="../files/public_javascripts_app_Main.js.html">Main.js</a></li><li>commands/<ul><li><a href="../files/public_javascripts_app_commands_BigWinCommand.js.html">BigWinCommand.js</a></li><li><a href="../files/public_javascripts_app_commands_Command.js.html">Command.js</a></li><li><a href="../files/public_javascripts_app_commands_CommandQueue.js.html">CommandQueue.js</a></li><li><a href="../files/public_javascripts_app_commands_CustomCommand.js.html">CustomCommand.js</a></li><li><a href="../files/public_javascripts_app_commands_FireworksCommand.js.html">FireworksCommand.js</a></li><li><a href="../files/public_javascripts_app_commands_RemoveBigWinCommand.js.html">RemoveBigWinCommand.js</a></li><li><a href="../files/public_javascripts_app_commands_SymbolAnimCommand.js.html">SymbolAnimCommand.js</a></li><li><a href="../files/public_javascripts_app_commands_WinLineCommand.js.html">WinLineCommand.js</a></li></ul></li><li>components/<ul><li><a href="../files/public_javascripts_app_components_BigWinComponent.js.html">BigWinComponent.js</a></li><li><a href="../files/public_javascripts_app_components_Dj.js.html">Dj.js</a></li><li><a href="../files/public_javascripts_app_components_GaffeButton.js.html">GaffeButton.js</a></li><li><a href="../files/public_javascripts_app_components_GaffeMenuComponent.js.html">GaffeMenuComponent.js</a></li><li><a href="../files/public_javascripts_app_components_GameComponent.js.html">GameComponent.js</a></li><li><a href="../files/public_javascripts_app_components_MeterComponent.js.html">MeterComponent.js</a></li><li><a href="../files/public_javascripts_app_components_ParticlesComponent.js.html">ParticlesComponent.js</a></li><li><a href="../files/public_javascripts_app_components_Reel.js.html">Reel.js</a></li><li><a href="../files/public_javascripts_app_components_ReelsComponent.js.html">ReelsComponent.js</a></li><li><a href="../files/public_javascripts_app_components_SymbolWinsComponent.js.html">SymbolWinsComponent.js</a></li><li><a href="../files/public_javascripts_app_components_WinLine.js.html">WinLine.js</a></li><li><a href="../files/public_javascripts_app_components_WinLinesComponent.js.html">WinLinesComponent.js</a></li></ul></li><li>core/<ul><li><a href="../files/public_javascripts_app_core_Game.js.html">Game.js</a></li><li><a href="../files/public_javascripts_app_core_GameData.js.html">GameData.js</a></li><li><a href="../files/public_javascripts_app_core_Preloader.js.html">Preloader.js</a></li><li><a href="../files/public_javascripts_app_core_ServerInterface.js.html">ServerInterface.js</a></li><li><a href="../files/public_javascripts_app_core_SignalDispatcher.js.html">SignalDispatcher.js</a></li><li><a href="../files/public_javascripts_app_core_SpinEvaluator.js.html">SpinEvaluator.js</a></li></ul></li><li>utils/<ul><li><a href="../files/public_javascripts_app_utils_QueueFactory.js.html">QueueFactory.js</a></li><li><a href="../files/public_javascripts_app_utils_Utils.js.html">Utils.js</a></li></ul></li></ul></li></ul></li></ul></li></ul>
                </div>
            </div>
            
        </div>

        <div id="main" class="yui3-u">
            <div class="content"><h4>public/javascripts/app/components/GaffeMenuComponent.js</h4>

<pre class="code prettyprint linenums">
/*! kingkong 0.0.6 - 2015-02-12
* Copyright (c) 2015 Licensed @HighFiveGames */

var G = G || {};

(function () {
	&quot;use strict&quot;;

	/**
	 * A GaffeMenu component which you can call show/hide from to show and hide the menu
	 * should also draw some buttons based on setup.json&#x27;s gaffes
	 *
	 * @class GaffeMenuComponent
	 * @param version {String}
	 * @constructor
	 */
	var GaffeMenuComponent = function(version) {
		this.version = version;
		this.GameComponent_constructor();
	};
	var p = createjs.extend(GaffeMenuComponent, G.GameComponent);
	p.constructor = GaffeMenuComponent;

	/**
	 * Store the buttons on the menu for deselection purposes
	 *
	 * @property buttons
	 * @type {G.GaffeButton[]}
	 */
	p.gaffeButtons = [];

	/**
	 * A version number which can be shown on the menu.
	 * nb. Only shows correct version when loading minified source
	 *
	 * @property version
	 * @type {string}
	 */
	p.version = &quot;&quot;;

	/**
	 * The gaffeing buttons get added to this container, which scrolls.
	 *
	 * @property hScrollContainer;
	 * @type {createjs.Container}
	 * @default null
	 */
	p.hScrollContainer = null;

	/**
	 *
	 *
	 * @property hScrollOffset
	 * @type {null}
	 */
	p.hScrollOffset = null;

	/**
	 *
	 *
	 * @property
	 * @type {number}
	 */
	p.currentCurrency = 0;

	/**
	 * @method init
	 * @param setup
	 * @param signalDispatcher
	 */
	p.init = function(setup, signalDispatcher) {
		this.GameComponent_init(setup, signalDispatcher);
	};

	/**
	 * @method drawMenu
	 */
	p.drawMenu = function(){
		var self = this;
		var w = this.setup.bezelW;
		var h = this.setup.bezelH;

		var shape, gp;
		shape = new createjs.Shape();
		gp = shape.graphics;
		gp.setStrokeStyle(4);
		gp.beginStroke(createjs.Graphics.getRGB(0, 20, 20, 0.9));
		gp.beginFill(createjs.Graphics.getRGB(50, 100, 150, 0.75));
		gp.drawRoundRect(0, 0, w ,h, 5);
		gp.endFill();
		gp.endStroke();

		this.addChild(shape);

		var closeButton = new createjs.Container();
		shape = new createjs.Shape();
		gp = shape.graphics;
		gp.setStrokeStyle(4);
		gp.beginStroke(createjs.Graphics.getRGB(50, 100, 150, 0.5));
		gp.beginFill(createjs.Graphics.getRGB(0, 20, 20, 0.9));
		gp.drawCircle(w, 0, 20);
		gp.endFill();
		gp.endStroke();

		var closeTxt = new createjs.Text(&quot;x&quot;, &quot;20px Helvetica&quot;, createjs.Graphics.getRGB(255,255,126,1));
		closeTxt.x = w - 5;
		closeTxt.y = - 12;

		this.hScrollContainer = new createjs.Container();
		this.addChild(this.hScrollContainer);

		var i, len = this.setup.gaffeMenu.length, button, data;
		// console.log(this.setup);
		for (i = 0; i &lt; len; i++) {
			data = this.setup.gaffeMenu[i];
			// console.log(&#x27;data&#x27;, data);
			button = new G.GaffeButton();
			button.init(data.type, 100, 100, 10);
			button.drawButton();
			button.x = 20 + i * button.width + i * 10;
			button.y = 40;
			button.on(&quot;click&quot;, this.gaffeButtonClicked, this);
			//button.clicked.addOnce(this.buttonClicked, this);
			this.hScrollContainer.addChild(button);
			this.gaffeButtons.push(button);
		}

		var sceneMask = new createjs.Shape();
		sceneMask.graphics.setStrokeStyle(0)
			.drawRect(0, 0, w, h)
			.closePath();
		this.addChild(sceneMask);

		this.hScrollContainer.mask = sceneMask;

		// using &quot;on&quot; binds the listener to the scope of the currentTarget by default
		// in this case that means it executes in the scope of the button.
		this.on(&quot;mousedown&quot;, function (evt) {
			//this.parent.addChild(this);
			self.hScrollOffset = {x: self.hScrollContainer.x - evt.stageX};
			///console.log(&#x27;mousedown ::&#x27;, self.hScrollOffset);
		});

		// the pressmove event is dispatched when the mouse moves after a mousedown on the target until the mouse is released.
		this.on(&quot;pressmove&quot;, function (evt) {
			//this.x = evt.stageX + this.offset.x;
			//this.y = evt.stageY + this.offset.y;
			// indicate that the stage should be updated on the next tick:
			//update = true;
			var scrollVal = evt.stageX + self.hScrollOffset.x;
			self.hScrollContainer.x = scrollVal &lt; 0? scrollVal : 0;
			//console.log(&#x27;pressmove ::&#x27;, self.hScrollOffset);
		});

		var fpsSwitch = new G.GaffeButton();
		fpsSwitch.init(&quot;60 FPS&quot;, 70, 60, 10);
		fpsSwitch.drawButton();
		fpsSwitch.x = w - fpsSwitch.width - 20;
		fpsSwitch.y = h - fpsSwitch.height -30;
		this.addChild(fpsSwitch);
		fpsSwitch.on(&quot;click&quot;, this.fpsClicked, this);
		fpsSwitch.select();

		var uaButton = new G.GaffeButton();
		uaButton.init(&quot;UA&quot;, 70, 60, 10);
		uaButton.drawButton();
		uaButton.x = fpsSwitch.x - uaButton.width - 20;
		uaButton.y = fpsSwitch.y;
		this.addChild(uaButton);
		uaButton.on(&quot;click&quot;, function() {
			alert(window.navigator.userAgent + &quot;\nScale:&quot; + G.Utils.currentScale);
		}, this);

		//fpsSwitch.clicked.addOnce(this.fpsClicked, this);
		var testButton = new G.GaffeButton();
		testButton.init(&quot;Test&quot;, 70, 60, 10);
		testButton.drawButton();
		testButton.x = uaButton.x - testButton.width - 20;
		testButton.y = uaButton.y;
		this.addChild(testButton);
		testButton.on(&quot;click&quot;, function() {
			window.open(&quot;/test&quot;,&quot;_blank&quot;);
		});

		var docsButton = new G.GaffeButton();
		docsButton.init(&quot;Docs&quot;, 70, 60, 10);
		docsButton.drawButton();
		docsButton.x = testButton.x - docsButton.width - 20;
		docsButton.y = testButton.y;
		this.addChild(docsButton);
		docsButton.on(&quot;click&quot;, function() {
			window.open(&quot;/doc&quot;, &quot;_blank&quot;);
		});

		var currencyButton = new G.GaffeButton();
		currencyButton.init(&quot;Currency&quot;, 70, 60, 10);
		currencyButton.drawButton();
		currencyButton.x = docsButton.x - currencyButton.width - 20;
		currencyButton.y = testButton.y;
		this.addChild(currencyButton);
		currencyButton.on(&quot;click&quot;, this.changeWinText, this);


		var labelTxt = new createjs.Text(&quot;Gaffe Menu&quot;, &quot;17px Helvetica&quot;, createjs.Graphics.getRGB(255,255,126,1));
		labelTxt.x = 5;
		labelTxt.y = 5;
		labelTxt.setBounds(0,0, this.setup.bezelW, this.setup.bezelH);
		var bounds = labelTxt.getBounds();
		labelTxt.filters = [new createjs.DropShadowFilter(3, 90, 0x00000,1, 4, 5, 5, 3, false, false, false)];
		labelTxt.cache(bounds.x, bounds.y, bounds.width, bounds.height);

		var versionTxt = new createjs.Text(&quot;Version:&quot; + this.version, &quot;12px sans-serif&quot;, createjs.Graphics.getRGB(255,255,255, 1));
		versionTxt.x = w - 10 - versionTxt.getMeasuredWidth();
		versionTxt.y = h - 10 - versionTxt.getMeasuredHeight();
		this.addChild(versionTxt);

		this.addChild(labelTxt);
		this.addChild(closeButton);
		closeButton.addChild(shape);
		closeButton.addChild(closeTxt);

		closeButton.on(&#x27;click&#x27;, function() {
			self.hide();
		});

		this.regX = w / 2;
		this.regY = h / 2;
		this.visible = false;

	};

	/**
	 pointers: Array[1],
	 changedPointers: Array[1],
	 pointerType: &quot;touch&quot;,
	 srcEvent: TouchEvent,
	 isFirst: falseâ€¦}
	 angle: 74.98163936884933
	 center: Object
	 	x: 523
	 	y: 369
	 __proto__: Object
	 changedPointers: Array[1]
	 0: Touchlength: 1
	 __proto__: Array[0]
	 deltaTime: 2838
	 deltaX: 44
	 deltaY: 164
	 direction: 16
	 distance: 169.799882214329
	 eventType: 4isFinal: true
	 isFirst: false
	 offset
	 Direction: 8
	 pointerType: &quot;touch&quot;
	 pointers: Array[1]
	 0: Touch
	 clientX: 523.43798828125
	 clientY: 369.1409912109375
	 force: 1
	 identifier: 0
	 pageX: 523.43798828125
	 pageY: 369.1409912109375
	 radiusX: 22.460935592651367
	 radiusY: 22.460935592651367
	 screenX: 302screenY: 386
	 target: canvas#app
	 webkitForce: 1
	 webkitRadiusX: 22.460935592651367
	 webkitRadiusY: 22.460935592651367
	 webkitRotationAngle: 0
	 __proto__: Touchlength: 1
	 __proto__: Array[0]
	 preventDefault: function () {
	 rotation: 0
	 scale: 1srcEvent: TouchEvent
	 target: canvas#app
	 timeStamp: 1425492270324
	 type: &quot;swipe&quot;
	 velocity: -0.7142857142857143
	 velocityX: 0
	 velocityY: -0.7142857142857143

	 * @param e
	 */
	/*
	p.hammerSwipeEvent = function(e) {
		//alert(e);
		//alert(e.deltaX);
	};*/

	/**
	 * dispatch to SignalDispatcher to update gaffe type
	 * @method buttonClicked
	 * @param e
	 */
	p.gaffeButtonClicked = function(e) {
		console.log(&#x27;buttonClicked&#x27;, this, e.currentTarget);
		var button = e.currentTarget;
		this.deselectGaffeButtons(button);
		this.signalDispatcher.gaffeSelect.dispatch(button.type);
		this.hide();
	};

	/**
	 * switch fps between 30 and 60
	 *
	 * @method fpsClicked
	 * @param e
	 */
	p.fpsClicked = function(e) {
		//console.log(&quot;fpsClicked&quot;, this, e);
		this.signalDispatcher.fpsSwitched.dispatch();
		var button = e.currentTarget;

		if (button.selected) {
			button.deselect();
			button.changeLabel(&quot;30 FPS&quot;);
		} else {
			button.changeLabel(&quot;60 FPS&quot;);
			button.select();
		}

	};

	/**
	 * @method deselectGaffeButtons
	 * @param {G.GaffeButton} [button] do not deselect this button
	 */
	p.deselectGaffeButtons = function(button) {
		var i, len = this.gaffeButtons.length, tempButton;
		for (i  = 0; i &lt; len; i++) {
			tempButton = this.gaffeButtons[i];
			if (!button || button !== tempButton) {
				tempButton.deselect();
			} else {
				tempButton.select();
			}
		}
	};

	/**
	 * Shows the gaffe menu
	 * @method show
	 */
	p.show = function() {
		this.visible = true;
		this.alpha = 0;
		this.scaleX = 0.01;
		this.scaleY = 0.01;

		createjs.Tween.get(this)
			.to({alpha: 1, scaleX: 1, scaleY: 1}, 400, createjs.Ease.getElasticOut(4,2));
	};

	/**
	 * visible false
	 * @method handleComplete
	 */
	p.handleComplete = function() {
		this.visible = false;
	};

	/**
	 * Hides the gaffe menu
	 * @method hide
	 */
	p.hide = function() {
		createjs.Tween.get(this)
			.to({alpha: 0, scaleX: 0.01, scaleY: 0.01}, 400, createjs.Ease.getElasticIn(4,2))
			.call(this.handleComplete);
	};

	/**
	 * For testing currency symbol switcheroo
	 *
	 * @method changeWinText
	 */
	p.changeWinText = function(){
		this.currentCurrency++;
		if (this.currentCurrency === this.setup.currencySymbol.length) {
			this.currentCurrency = 0;
		}
		console.log(this.currentCurrency);
		var meterComponent = G.Utils.getGameComponentByClass(G.MeterComponent);
		meterComponent.currencySymbolChange(this.setup.currencySymbol[this.currentCurrency]);
	};


	G.GaffeMenuComponent = createjs.promote(GaffeMenuComponent, &quot;GameComponent&quot;);

})();
</pre>

</div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/js/tabs.js"></script>
</body>
</html>
