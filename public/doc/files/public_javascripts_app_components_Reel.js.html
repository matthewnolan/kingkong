<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>public/javascripts/app/components/Reel.js - kingkong</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.8.0pr2/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <script src="http://yui.yahooapis.com/combo?3.8.0pr2/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1><a href="../index.html"><img src="../assets/css/kong-header.png" width="389" height="100">kingkong: public/javascripts/app/components/Reel.js v0.3.4</a></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.3.4</em>
        </div>
    </div>
    <div class="yui3-g">

        <div id="sidebar" class="yui3-u">
            <div id="modules" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Modules</h2>
                </div>
                <div class="bd">
                    <ul>
                    </ul>
                </div>
            </div>
            
            <div id="classes" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Classes</h2>
                </div>
                <div class="bd">
                    <ul>
                            <li><a href="../classes/BigWinComponent.html">BigWinComponent</a></li>
                            <li><a href="../classes/Command.html">Command</a></li>
                            <li><a href="../classes/CommandQueue.html">CommandQueue</a></li>
                            <li><a href="../classes/CustomCommand.html">CustomCommand</a></li>
                            <li><a href="../classes/Dj.html">Dj</a></li>
                            <li><a href="../classes/FireworksCommand.html">FireworksCommand</a></li>
                            <li><a href="../classes/G.BigWinCommand.html">G.BigWinCommand</a></li>
                            <li><a href="../classes/GaffeButton.html">GaffeButton</a></li>
                            <li><a href="../classes/GaffeMenuComponent.html">GaffeMenuComponent</a></li>
                            <li><a href="../classes/Game.html">Game</a></li>
                            <li><a href="../classes/GameComponent.html">GameComponent</a></li>
                            <li><a href="../classes/GameData.html">GameData</a></li>
                            <li><a href="../classes/Main.html">Main</a></li>
                            <li><a href="../classes/MeterComponent.html">MeterComponent</a></li>
                            <li><a href="../classes/ParticlesComponent.html">ParticlesComponent</a></li>
                            <li><a href="../classes/Preloader.html">Preloader</a></li>
                            <li><a href="../classes/QueueFactory.html">QueueFactory</a></li>
                            <li><a href="../classes/Reel.html">Reel</a></li>
                            <li><a href="../classes/ReelsComponent.html">ReelsComponent</a></li>
                            <li><a href="../classes/ServerInterface.html">ServerInterface</a></li>
                            <li><a href="../classes/SignalDispatcher.html">SignalDispatcher</a></li>
                            <li><a href="../classes/SpinEvaluator.html">SpinEvaluator</a></li>
                            <li><a href="../classes/SymbolAnimCommand.html">SymbolAnimCommand</a></li>
                            <li><a href="../classes/SymbolWinsComponent.html">SymbolWinsComponent</a></li>
                            <li><a href="../classes/Utils.html">Utils</a></li>
                            <li><a href="../classes/WinLine.html">WinLine</a></li>
                            <li><a href="../classes/WinLineCommand.html">WinLineCommand</a></li>
                            <li><a href="../classes/WinLinesComponent.html">WinLinesComponent</a></li>
                    </ul>
                </div>
            </div>
            
            
            
            
            
            <div id="fileTree" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Files</h2>
                </div>
                <div class="bd">
                    <ul><li>public/<ul><li>javascripts/<ul><li>app/<ul><li><a href="../files/public_javascripts_app_Main.js.html">Main.js</a></li><li>commands/<ul><li><a href="../files/public_javascripts_app_commands_BigWinCommand.js.html">BigWinCommand.js</a></li><li><a href="../files/public_javascripts_app_commands_Command.js.html">Command.js</a></li><li><a href="../files/public_javascripts_app_commands_CommandQueue.js.html">CommandQueue.js</a></li><li><a href="../files/public_javascripts_app_commands_CustomCommand.js.html">CustomCommand.js</a></li><li><a href="../files/public_javascripts_app_commands_FireworksCommand.js.html">FireworksCommand.js</a></li><li><a href="../files/public_javascripts_app_commands_RemoveBigWinCommand.js.html">RemoveBigWinCommand.js</a></li><li><a href="../files/public_javascripts_app_commands_SymbolAnimCommand.js.html">SymbolAnimCommand.js</a></li><li><a href="../files/public_javascripts_app_commands_WinLineCommand.js.html">WinLineCommand.js</a></li></ul></li><li>components/<ul><li><a href="../files/public_javascripts_app_components_BigWinComponent.js.html">BigWinComponent.js</a></li><li><a href="../files/public_javascripts_app_components_Dj.js.html">Dj.js</a></li><li><a href="../files/public_javascripts_app_components_GaffeButton.js.html">GaffeButton.js</a></li><li><a href="../files/public_javascripts_app_components_GaffeMenuComponent.js.html">GaffeMenuComponent.js</a></li><li><a href="../files/public_javascripts_app_components_GameComponent.js.html">GameComponent.js</a></li><li><a href="../files/public_javascripts_app_components_MeterComponent.js.html">MeterComponent.js</a></li><li><a href="../files/public_javascripts_app_components_ParticlesComponent.js.html">ParticlesComponent.js</a></li><li><a href="../files/public_javascripts_app_components_Reel.js.html">Reel.js</a></li><li><a href="../files/public_javascripts_app_components_ReelsComponent.js.html">ReelsComponent.js</a></li><li><a href="../files/public_javascripts_app_components_SymbolWinsComponent.js.html">SymbolWinsComponent.js</a></li><li><a href="../files/public_javascripts_app_components_WinLine.js.html">WinLine.js</a></li><li><a href="../files/public_javascripts_app_components_WinLinesComponent.js.html">WinLinesComponent.js</a></li></ul></li><li>core/<ul><li><a href="../files/public_javascripts_app_core_Game.js.html">Game.js</a></li><li><a href="../files/public_javascripts_app_core_GameData.js.html">GameData.js</a></li><li><a href="../files/public_javascripts_app_core_Preloader.js.html">Preloader.js</a></li><li><a href="../files/public_javascripts_app_core_ServerInterface.js.html">ServerInterface.js</a></li><li><a href="../files/public_javascripts_app_core_SignalDispatcher.js.html">SignalDispatcher.js</a></li><li><a href="../files/public_javascripts_app_core_SpinEvaluator.js.html">SpinEvaluator.js</a></li></ul></li><li>utils/<ul><li><a href="../files/public_javascripts_app_utils_QueueFactory.js.html">QueueFactory.js</a></li><li><a href="../files/public_javascripts_app_utils_Utils.js.html">Utils.js</a></li></ul></li></ul></li></ul></li></ul></li></ul>
                </div>
            </div>
            
        </div>

        <div id="main" class="yui3-u">
            <div class="content"><h4>public/javascripts/app/components/Reel.js</h4>

<pre class="code prettyprint linenums">
/*! kingkong 0.0.1 - 2015-02-04
* Copyright (c) 2015 Licensed @HighFiveGames */

var G = G || {};

(function () {
	&quot;use strict&quot;;

	/**
	 * One Reel defined by this class. Contains a sprite map for mapping sprite ids to symbol sprites.
	 * Sets up and executes the spin animation Tween when reels are spun.
	 * Stops the tween when spinning is ended and signals to the ReelComponent.
	 *
	 * @class Reel
	 * @extends createjs.Container
	 * @constructor
	 */
	var Reel = function() {
		this.Container_constructor();
	};

	var p = createjs.extend(Reel, createjs.Container);
	p.constructor = Reel;

	/**
	 * array of symbolData: initial drawing of reels uses this array of data to draw symbols based on symbolId.
	 * See setup.json for symbolIds and slotInit for the default reelstrips configuration.
	 *
	 * @property reelData
	 * @type {Array}
	 */
	p.reelData = [];

	/**
	 * Good old setup.json stored here
	 *
	 * @property setup
	 * @type {Object}
	 */
	p.setup = null;

	/**
	 * Reference to signalDispatcher
	 *
	 * @property signalDispatcher
	 * @type {G.SignalDispatcher}
	 */
	p.signalDispatcher = null;

	/**
	 * SpriteSheet containing static reel symbol images.
	 *
	 * @property symbolSprites
	 * @type {createjs.SpriteSheet}
	 */
	p.symbolSprites = null;

	/**
	 * wraps symbol sprites for easier modification there are 2 of these containers because each reel contains duplicate symbols
	 * for wrapping purposes during spin.
	 *
	 * @property wrap1
	 * @type {createjs.Sprite[]}
	 */
	p.wrap1 = [];

	/**
	 * wraps symbol sprites for easier modification there are 2 of these containers because each reel contains duplicate symbols
	 *
	 * @property wrap2
	 * @type {createjs.Sprite[]}
	 */
	p.wrap2 = [];

	/**
	 * contains an extra row of symbol sprites which are appended above the first row of symbols, so there are some
	 * visible sprites in case the reels are spun to first index position. Stored here so they can be modified on spin
	 *
	 * @property upperBuffer
	 * @type {createjs.Sprite[]}
	 */
	p.upperBuffer = [];

	/**
	 * contains an extra 2 rows of symbols sprites which are appended to the last row of symbols, so there are some
	 * visible sprites in case the reels are spun to last index position.
	 *
	 * @property lowerBuffer
	 * @type {Array}
	 */
	p.lowerBuffer = [];

	/**
	 * Set flag to true to debug animation y positions.
	 *
	 * @property logEnabled
	 * @type {boolean}
	 * @default false
	 */
	p.logEnabled = false;

	/**
	 * Set this number to -2, to schedule the reel spin animation to stop, -1 will make the spin continue to loop for an infinite number spins.
	 *
	 * @property sheduleSpinStop
	 * @type {number}
	 * @default -2
	 */
	p.scheduleSpinStop = -2;

	/**
	 * Dynamically alter the speed of reels by changing this percentage:
	 *
	 * eg. 0.5 = half speed reels
	 * @type {number}
	 */
	p.speedPercentage = 0.5;

	/**
	 * Maximum Speed the reels can spin (pixels per second)
	 *
	 * @const speedConstant
	 * @default 5000
	 * @type {number}
	 */
	p.speedConstant = 5000;

	/**
	 *
	 *
	 * @property spriteMap
	 * @type {string[]}
	 * @example [&#x27;ww&#x27;,&#x27;m1&#x27;, &#x27;m2&#x27;, &#x27;m3&#x27;, &#x27;m4&#x27;, &#x27;f5&#x27;, &#x27;f6&#x27;, &#x27;f7&#x27;, &#x27;f8&#x27;, &#x27;f9&#x27;, &#x27;f0&#x27;, &#x27;d1&#x27;, &#x27;d2&#x27;, &#x27;d3&#x27;, &#x27;d4&#x27;, &#x27;b1&#x27;, &#x27;b2&#x27;, &#x27;ww&#x27;];
	 * @default null
	 */
	p.spriteMap = null;

	/**
	 * Stores the current spin tween animation
	 *
	 * @property tween
	 * @type {null}
	 */
	p.tween = null;

	/**
	 * dispatched when a spin animation on this reel is completed.
	 * Used by ReelsContainer to notify the app of a completed spin animation
	 *
	 * @property reelSpinEnd
	 * @type {Signal}
	 */
	p.reelSpinEnd = new signals.Signal();

	/**
	 * setTimeout responsible for automatically stopping a reel spin animation.
	 * @property stopTimeout
	 * @type {number}
	 */
	p.stopTimeout = 0;

	/**
	 * The index position the reels must stop at.  Represents the index position inside this.reelsData where the top symbol will stop at.
	 *
	 * @property spinResultIndex
	 * @type {number}
	 */
	p.spinResultIndex = 0;

	/**
	 * Flag set to true when this.modifyReelData is called
	 *
	 * @property scheduleSymbolUpdate
	 * @type {boolean}
	 */
	p.scheduleSymbolUpdate = false;

	/**
	 * scaleFactor for static symbols: defined in setup.json
	 *
	 * @property scaleFactor
	 * @type {number}
	 * @default null
	 */
	p.scaleFactor = null;

	/**
	 * Flag set to true when a slam is called on this reel.
	 * Slamming happens when a user hits space bar during a spin, to stop the reels
	 *
	 * @property isSlamming
	 * @type {boolean}
	 * @default false
	 */
	p.isSlamming = false;

	/**
	 * Initialise Class vars and passes in instance of setup, symbolSprites, and initial reelData
	 *
	 * @method init
	 * @param setup
	 * @param signalDispatcher
	 * @param symbolSprites
	 * @param reelData
	 */
	p.init = function(setup, signalDispatcher, symbolSprites, reelData) {

		this.setup = setup;
		this.signalDispatcher = signalDispatcher;
		this.symbolSprites = symbolSprites;
		this.reelData = reelData;
		this.wrap1 = [];
		this.wrap2 = [];
		this.upperBuffer = [];
		this.lowerBuffer = [];
		this.spriteMap = _.map(this.setup.reelAnimation.symbols.data, function(data) {
			return data.frameLabel;
		});
		this.scaleFactor = this.setup.spritesScaleFactor.staticImages;
	};

	/**
	 * Call this when spin data is received.
	 * The sprites on this reel will be scheduled to update according to the spin data after 1 spin loop.
	 *
	 * @method modifyReelData
	 * @param {number[]} reelData array of symbolId&#x27;s to modify to.
	 */
	p.modifyReelData = function(reelData) {
		if (reelData.length !== this.reelData.length) {
			throw &quot;reelData count mismatch: &quot; + reelData.length + &quot; should equal this.reelData.length: &quot; + this.reelData.length;
		}
		this.scheduleSymbolUpdate = true;
		this.reelData = reelData;
	};

	/**
	 * If reelData has been modified then schedule this function on during the first spin &#x27;loop&#x27;.
	 * This will then update the reel sprites according to the new reelData array
	 *
	 * @method updateSymbolSprites
	 */
	p.updateSymbolSprites = function() {
		if (this.scheduleSymbolUpdate) {
			this.scheduleSymbolUpdate = false;
			var i, l, j, len = this.reelData.length, symbolIndex;
			for (i = 0; i &lt; len; i++) {
				symbolIndex = this.reelData[i];
				this.wrap1[i].gotoAndStop(this.spriteMap[symbolIndex]);
				this.wrap2[i].gotoAndStop(this.spriteMap[symbolIndex]);
			}

			for (l = 0; l &lt; 2; l++) {
				var buffer = l === 0 ? this.upperBuffer : this.lowerBuffer;
				for (j = 0; j &lt; 2; j++) {
					symbolIndex = len - 2 + j - (l * (len - 2));
					buffer[j].gotoAndStop(this.spriteMap[this.reelData[symbolIndex]]);
				}
			}
		}

		if (this.isSlamming) {
			clearInterval(this.stopTimeout);
			this.scheduleSpinStop = -2;
			this.speedPercentage = 1;
		}
	};

	/**
	 * Draws a ReelStrip of symbols based on slotInit.reelStrips indexes and setup.json symbol.frameLabels.
	 * Replacement symbols are derived from setup.json, and if either the index or the label are matching, then replace the symbol sprite image
	 * with the defaultReplacementLabel
	 * debugging sprites are drawn if setup.json activates &quot;devMode&quot;:1
	 * Each reelStrip draws a set (wrap) of symbols twice to allow for speedy reelAnimation looping without missing symbols
	 * A buffer (n number of symbols - configurable) is also drawn above and below the 2 wraps to allow for elastic bounce easing on spin animations and to facilitate
	 * the spin animation.
	 *
	 * The fullset of slotInit.reelstips is not drawn here, as animating 90+ symbols in a reelstrip is very laggy
	 * So during init, a 10 cut version of the reelStrips iss created.
	 *
	 * @method drawReel
	 */
	p.drawReel = function() {
		var symbolW = this.setup.symbolW;
		var symbolH = this.setup.symbolH;
		var symbolMarginB = this.setup.symbolMarginBottom;
		var container, len = this.reelData.length;
		var replacementSymbolIndex = this.setup.reelAnimation.symbols.replacement.index;
		var replacementSymbolLabel = this.setup.reelAnimation.symbols.replacement.frameLabel;
		var defaultReplacementLabel = this.setup.reelAnimation.symbols.replacement.defaultLabel;
		var l, j, sp, debugSh, gp, text, text2;
		var reelHeight = this.reelData.length * symbolH + this.reelData.length * symbolMarginB;
		var wrapPosY;
		var spriteContainer;
		for (l = 0; l &lt; 2; l++) {
			//creates 2 reel wrappers
			var wrap = new createjs.Container();
			this.addChild(wrap);

			spriteContainer = l === 0? this.wrap1 : this.wrap2;

			for (j = 0; j &lt; len; j++) {
				//creates a symbol for every index in reelData array
				container = new createjs.Container();
				var frameLabel = this.spriteMap[this.reelData[j]];
				//default replacement switcheroo
				if (frameLabel === replacementSymbolLabel || this.reelData[j] === replacementSymbolIndex) {
					frameLabel = defaultReplacementLabel;
				}

				sp = new createjs.Sprite(this.symbolSprites, frameLabel);
				sp.scaleX = sp.scaleY = this.scaleFactor;

				spriteContainer.push(sp);
				container.addChild(sp);
				if (this.setup.devMode) {
					var wrapColor = l === 0? &quot;#00ff00&quot; : &quot;#ff0000&quot;;
					debugSh = new createjs.Shape();
					gp = debugSh.graphics;
					gp.setStrokeStyle(2);
					gp.beginStroke(wrapColor);
					gp.beginFill(&quot;rgba(128,3,95,0.3)&quot;);
					gp.drawRect(0, 0, symbolW, symbolH);
					gp.endFill().endStroke();
					container.addChild(debugSh);
					text = new createjs.Text(&quot;Symbol:&quot; + j + &quot;:&quot; + this.spriteMap[this.reelData[j]], &quot;12px Arial&quot;, &quot;#ffffff&quot;);
					text2 = new createjs.Text(&quot;Wrap:&quot; + l, &quot;12px Arial&quot;, &quot;#ffffff&quot;);
					text.x = 0;
					container.addChild(text);
					container.addChild(text2);
					text2.y = 14;
				}
				wrap.addChild(container);
				container.y = (symbolH * j + symbolMarginB * j);
			}
			wrapPosY = wrap.y = -l * reelHeight;

			var buffer = l === 0 ? this.upperBuffer : this.lowerBuffer;
			var numBuffer = 2;

			for (j = 0; j &lt; numBuffer; j++) {
				//j rows of symbols to buffer above and below the symbol wrappers
				var symbolBufferWrap = new createjs.Container();
				this.addChild(symbolBufferWrap);
				container = new createjs.Container();
				var tempSymbolIndex = len - numBuffer + j - (l * (len - 2));
				sp = new createjs.Sprite(this.symbolSprites, this.spriteMap[this.reelData[tempSymbolIndex]]);
				sp.scaleX = sp.scaleY = this.scaleFactor;
				container.addChild(sp);
				container.y = (symbolH * j + symbolMarginB * j);
				symbolBufferWrap.addChild(container);
				symbolBufferWrap.y = -reelHeight - numBuffer * (symbolH - symbolMarginB) + (l * (2 * (symbolH - symbolMarginB) + reelHeight * 2));
				buffer.push(sp);

				if (this.setup.devMode) {
					debugSh = new createjs.Shape();
					gp = debugSh.graphics;
					gp.setStrokeStyle(2);
					gp.beginStroke(&#x27;#0000ff&#x27;);
					gp.drawRect(0,0,symbolW, symbolH);
					gp.endFill().endStroke();
					container.addChild(debugSh);
					text = new createjs.Text(&quot;SymbolIndexBuffer&quot;, &quot;12px Arial&quot;, &quot;#ffffff&quot;);
					text2 = new createjs.Text(&quot;Wrap:&quot; + (l + 2), &quot;12px Arial&quot;, &quot;#ffffff&quot;);
					text.x = 0;
					container.addChild(text);
					container.addChild(text2);
					text2.y = 14;
				}
			}
		}
	};

	/**
	 * Spin this reel to the specified index position with a given delay
	 *
	 * @method spinToIndex
	 * @param {Number} index - index of symbol on this reel to spin to (top left of reel should spin to this index)
	 * @param {Number} delay - Millis til this spin will start
	 */
	p.spinToIndex = function(index, delay) {
		var self = this;
		this.isSlamming = false;
		this.speedPercentage = 0.5;
		var symbolH = this.setup.symbolH;
		var symbolMarginB = this.setup.symbolMarginBottom;
		var symbolsLen = this.reelData.length;
		var spinDelay = delay || 0;
		var reelH = symbolH * symbolsLen + symbolMarginB * symbolsLen;
		var yPos = reelH;
		var tweenTime = this.getTime();

		this.y = -this.spinResultIndex * symbolH + -this.spinResultIndex * symbolMarginB;

		this.spinResultIndex = index;
		this.scheduleSpinStop = -1;

		if (this.logEnabled) {
			console.log(&#x27;Tween_Start:&#x27;, this.y, yPos, tweenTime);
			console.log(&#x27;SymbolsHeight:&#x27;, symbolH * symbolsLen + symbolMarginB * symbolsLen);
		}

		createjs.Tween.get(this)
			.wait(delay)
			.play(
				createjs.Tween.get(this, {loop: false, paused:true})
					.to({y:yPos}, tweenTime, createjs.Ease.getElasticIn(2,2))
					.call(this.loopSpin)
		);


		this.stopTimeout = setTimeout(function() {
			self.scheduleFastStop();
		}, this.setup.reelAnimation.duration + spinDelay);
	};

	/**
	 * Returns the time required to tween this reel through a set of this.reelData.length symbols
	 *
	 * @method getTime
	 * @returns {number}
	 */
	p.getTime = function() {
		var symbolH = this.setup.symbolH;
		var symbolMarginB = this.setup.symbolMarginBottom;
		var symbolsLen = this.reelData.length;
		var distanceInPixels = symbolH * symbolsLen + symbolMarginB * symbolsLen;
		return distanceInPixels / (this.speedPercentage * this.speedConstant / 1000);
	};

	/**
	 * Begins a new loop of spinning animation beginning at this.y 0 and ending at the end of 1 set of symbols
	 *
	 * @method loopSpin
	 */
	p.loopSpin = function() {
		var symbolH = this.setup.symbolH;
		var symbolMarginB = this.setup.symbolMarginBottom;
		var symbolsLen = this.reelData.length;
		var reelH = symbolH * symbolsLen + symbolMarginB * symbolsLen;
		var tweenTime = this.getTime();
		var yPos;
		if (this.scheduleSpinStop === -1) {
			this.y = 0;
			yPos = reelH;
			this.updateSymbolSprites();

		} else if (this.scheduleSpinStop === -2) {
			this.stopSpinTween();
			return;

		} else {
			return;
		}

		if (this.logEnabled) {
			console.log(&#x27;Tween_Loop:&#x27;, this.y, yPos, tweenTime);
		}

		createjs.Tween
			.get(this, {override: true, loop: false })
			.to({y: yPos}, tweenTime, createjs.Ease.linear())
			.call(this.loopSpin)
			.on(&quot;change&quot;, this.onYPosUpdate);
	};

	/**
	 * Returns the time required for the stop tween animation (from this.y 0 to the symbol stop index). Uses number of pixels as the distance
	 *
	 * @method getStopTime
	 * @param {number} index - the symbol index the tween animation is going to stop at
	 * @returns {number}
	 */
	p.getStopTime =function(index) {
		var symbolH = this.setup.symbolH;
		var symbolMarginB = this.setup.symbolMarginBottom;
		var symbolsLen = this.reelData.length;
		var reelH = symbolsLen * symbolH + symbolsLen * symbolMarginB;
		var distanceInPixels = (symbolH * index + symbolMarginB * index) + reelH;
		return distanceInPixels / (this.speedPercentage * this.speedConstant / 1000);
	};

	/**
	 * Tweens this reelStrip to the y position of the spinResultIndex
	 * Schedules a reelStop sound via playSound signal
	 * Calls handleSpinComplete on when tween is finished.
	 *
	 * @method stopSpinTween
	 */
	p.stopSpinTween = function() {
		console.log(&#x27;stopSpinTween&#x27;, this.spinResultIndex);
		var self = this;
		var index = this.spinResultIndex;
		var symbolH = this.setup.symbolH;
		var symbolMarginB = this.setup.symbolMarginBottom;
		var symbolsLen = this.reelData.length;
		var reelH = (symbolH * symbolsLen) + (symbolMarginB * symbolsLen);
		var yPos = -(symbolH * index + symbolMarginB * index) + reelH;
		var stopTime = this.getStopTime(index);
		var easeAmp = 1 + index * (this.reelData.length * 0.2);
		var easeTime = 1 - index * (this.reelData.length * 0.02);

		setTimeout(function() {
			self.signalDispatcher.playSound.dispatch(&quot;reelstop1&quot;);
		}, stopTime - 300);

		this.y = 0;

		if (this.logEnabled) {
			console.log(&#x27;Tween_Stop&#x27;, this.y, yPos, stopTime, &#x27;easeAmp=&#x27;, easeAmp);
		}

		createjs.Tween
			.get(this, {override: true, loop:false})
			.to({y: yPos}, stopTime, createjs.Ease.getElasticOut(easeAmp,easeTime))
			.call(this.handleSpinComplete)
			.on(&quot;change&quot;, this.onYPosUpdate);
	};

	/**
	 * For debugging spin animation purposes
	 * @method onYPosUpdate
	 */
	p.onYPosUpdate = function() {
		var self = this.target;
		if (self.logEnabled) {
			console.log(&#x27;this.Container Y=&#x27;, Math.round(self.y));
		}
	};

	/**
	 * Manually stops the current spin animation - also called automatically by the stopTimeout.
	 * @method fastStop
	 */
	p.scheduleFastStop = function() {
		if (this.scheduleSpinStop &gt; -2) {
			this.isSlamming = true;
		}
	};


	/**
	 * Dispatches the reelSpinEnd signal when the reel spin animation is completed.
	 * @event handleSpinComplete
	 */
	p.handleSpinComplete = function() {
		this.reelSpinEnd.dispatch();
	};

	/**
	 * Modify the spin speed percentage value (accepts 0-100%);
	 * Reels will spin at this perecentage of the speedConstant in pixels per second.
	 * @method spinSpeedIncrement
	 * @param val
	 */
	p.spinSpeedIncrement = function(val) {
		if (this.speedPercentage !== val) {
			this.speedPercentage = val;
		}
	};



	G.Reel = createjs.promote(Reel, &quot;Container&quot;);

})();
</pre>

</div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/js/tabs.js"></script>
</body>
</html>
