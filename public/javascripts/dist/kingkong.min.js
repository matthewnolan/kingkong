/*! kingkong 0.0.6 - 2015-02-11
* Copyright (c) 2015 Licensed @HighFiveGames */
var G=G||{};!function(){"use strict";var a=function(){},b=a.prototype;b.constructor=a,b.loopIndex=0,b.callNextDelay=2e3,b.setup=null,b.gameComponent=null,b.init=function(a,b){this.setup=a,this.gameComponent=b},b.execute=function(){},G.Command=a}();var G=G||{};!function(){"use strict";var a=function(){},b=a.prototype;b.constructor=a,b.setup=null,b.queue=[],b.timeout=null,b.shouldLoop=!1,b.loopReturnIndex=0,b.queueFactory=null,b.currentIndex=0,b.gameComponents=null,b.init=function(a,b){this.setup=a,this.gameComponents=b,this.queueFactory=new G.QueueFactory,this.queueFactory.init(a,b)},b.setupQueue=function(){createjs.Sound.play("bonusStop1");var a=_.find(this.gameComponents,function(a){return a instanceof G.WinLinesComponent}),b=new G.WinLineCommand;b.init(this.setup,a,[1,2,3,4,5]),this.queue=[b]},b.play=function(){var a=this.queue.length;a&&this.executeNext()},b.executeNext=function(){var a=this,b=this.queue[this.currentIndex];if(b.execute(),b.loopIndex&&(this.loopReturnIndex=b.loopIndex),this.currentIndex++===this.queue.length-1){if(!this.shouldLoop)return void this.flushQueue();this.currentIndex=0}this.timeout=setTimeout(function(){a.executeNext.call(a)},b.callNextDelay)},b.stop=function(){throw"not implemented"},b.flushQueue=function(){clearTimeout(this.timeout),this.currentIndex=0,this.queue=[]},G.CommandQueue=a}(),this.G=this.G||{},function(){"use strict";var a=function(){},b=a.prototype;b.constructor=a,b.setup=null,b.serverInterface=null,b.stage=null,b.assets=null,b.signalDispatcher=null,b.components={reels:null,winLines:null},b.gameComponents=[],b.init=function(a,b){this.serverInterface=b,this.stage=a;var c=new G.Preloader;c.init(this,this.SETUP_URL),c.setupComplete.add(this.onSetupLoaded,this),c.assetsLoaded.add(this.onAssetsLoadComplete,this),c.startLoad()},b.onSetupLoaded=function(a){this.setup=a},b.onAssetsLoadComplete=function(a){this.assets=a,this.signalDispatcher=new G.SignalDispatcher,this.setupDisplay(),this.initUIEvents()},b.setupDisplay=function(){var a=this.setup.bezelMarginL,b=this.setup.bezelMarginT,c=this.setup.bezelW,d=this.setup.bezelH,e=new createjs.SpriteSheet(this.assets.spriteSheetStatics),f=new createjs.Sprite(e,"ui-bezel");this.stage.addChild(f);var g=new G.ReelsComponent;g.init(this.setup,this.signalDispatcher,e),g.drawReels(),g.x=a,g.y=b,this.stage.addChild(g);var h=new G.WinLinesComponent;h.init(this.setup,this.signalDispatcher),this.stage.addChild(h),h.drawComponent(),this.components.reels=g,this.components.winLines=h,this.gameComponents.push(g,h),this.signalDispatcher.init(this.setup,this.gameComponents);var i=new createjs.Shape;i.graphics.setStrokeStyle(0).drawRect(a,b,c,d).closePath(),this.stage.addChild(i),this.setup.devMode||(g.mask=i)},b.initUIEvents=function(){var a=this;window.document.onkeydown=function(b){switch(b.keyCode){case 32:case 0:a.components.reels.spinReels()}},createjs.Touch.enable(this.stage);var b=document.querySelector("#app"),c=new Hammer(b);c.get("swipe").set({direction:Hammer.DIRECTION_ALL}),c.get("pinch").set({enable:!0}),c.on("swipe",function(){a.components.reels.spinReels()}),c.on("pinchin",function(){}),c.on("pinchout",function(){}),this.setup.domHelpers||$(".dom-helpers").remove()},G.Game=a}();var G=G||{};!function(){"use strict";var a=function(){this.Container_constructor()},b=createjs.extend(a,createjs.Container);b.constructor=a,b.signalDispatcher=null,b.setup=null,b.init=function(a,b){this.setup=a,this.signalDispatcher=b},G.GameComponent=createjs.promote(a,"Container")}(),this.G=this.G||{},function(){"use strict";var a=function(){},b=a.prototype;b.constructor=a,b.stats=null,b.stage=null,b.game=null,b.init=function(){this.stats=new Stats,this.stats.setMode(0),this.stats.domElement.style.position="absolute",this.stats.domElement.style.bottom="0px",this.stats.domElement.style.left="0px",document.body.appendChild(this.stats.domElement);var a=667,b=375,c=.75;this.stage=new createjs.Stage("app"),this.stage.scaleX=c,this.stage.scaleY=c;var d=(a*c).toString()+"px",e=(b*c).toString()+"px",f=document.querySelector("#app");f.setAttribute("width",d),f.setAttribute("height",e);var g=document.querySelector("#preloader");g.style.width=d,g.style.height=e,createjs.Ticker.on("tick",this.handleTick,this),createjs.Ticker.setFPS(60);var h=new G.ServerInterface;h.init(),this.game=new G.Game,this.game.init(this.stage,h)},b.handleTick=function(){this.stats.begin(),this.stage.update(),this.stats.end()},G.Main=a}(),this.G=this.G||{},function(){"use strict";var a=function(){},b=a.prototype;b.constructor=a,b.SETUP_URL="assets/config/setup.json",b.game=null,b.setupLoader=null,b.assetsLoader=null,b.spriteSheetBigWin=null,b.spriteSheetStatics=null,b.spriteSheetSymbolAnims=null,b.setupComplete=new signals.Signal,b.assetsLoaded=new signals.Signal,b.init=function(a){this.game=a,this.setupLoader=new createjs.LoadQueue(!0),this.setupLoader.on("fileload",this.handleSetupLoaded,this),this.assetsLoader=new createjs.LoadQueue(!0),this.assetsLoader.on("error",this.handleAssetsError,this),this.assetsLoader.on("progress",this.handleAssetsProgress,this),this.assetsLoader.on("complete",this.handleAssetsLoaded,this),this.assetsLoader.installPlugin(createjs.Sound)},b.startLoad=function(){this.setupLoader.loadFile(this.SETUP_URL)},b.handleSetupLoaded=function(a){this.setupComplete.dispatch(a.result),this.loadGameAssets()},b.loadGameAssets=function(){this.assetsLoader.loadManifest(this.game.setup.spritesManifest),this.assetsLoader.loadManifest(this.game.setup.soundsManifest)},b.handleAssetsError=function(){},b.handleAssetsProgress=function(a){var b=document.querySelector("#loadPercentage");b.innerHTML=Math.round(100*a.progress).toString()+"%"},b.handleAssetsLoaded=function(){var a=this,b={spriteSheetBigWin:this.assetsLoader.getResult("bigWinAnim"),spriteSheetStatics:this.assetsLoader.getResult("staticImages"),spriteSheetSymbolAnims:this.assetsLoader.getResult("symbolAnims")},c=document.querySelector("#loadState");c.innerHTML="Loaded",c=document.querySelector("#initializeState"),c.innerHTML="Initializing...",setTimeout(function(){a.assetsLoaded.dispatch(b)},50)},G.Preloader=a}();var G=G||{};!function(){"use strict";var a=function(){},b=a.prototype;b.constructor=a,b.init=function(a,b){this.setup=a,this.gameComponents=b},G.QueueFactory=a}();var G=G||{};!function(){"use strict";var a=function(){this.Container_constructor()},b=createjs.extend(a,createjs.Container);b.constructor=a,b.reelData=[],b.setup=null,b.symbolSprites=null,b.containers={main:this,wraps:[]},b.scheduleSpinStop=-2,b.speedPercentage=.5,b.speedConstant=6e3,b.spriteMap=["ww","m1","m2","m3","m4","f5","f6","f7","f8","f9","f0","d1","d2","d3","d4","b1","b2"],b.tween=null,b.scheduleSpeedChange=!1,b.reelSpinEnd=new signals.Signal,b.stopTimeout=0,b.spinResultIndex=null,b.init=function(a,b,c){this.setup=a,this.symbolSprites=b,this.reelData=c},b.getTime=function(){var a=this.setup.symbolH,b=this.setup.symbolMarginBottom,c=this.reelData.length,d=a*c+b*c,e=d/(this.speedPercentage*this.speedConstant/1e3);return e},b.getStopTime=function(a){var b=this.setup.symbolH,c=this.setup.symbolMarginBottom,d=this.reelData.length,e=b*a+c*a+(b*d+c*d),f=e/(this.speedPercentage*this.speedConstant/1e3);return f},b.drawReel=function(){var a,b,c,d=this.setup.symbolH,e=this.setup.symbolMarginBottom;for(a=0;2>a;a++){var f=new createjs.Container;for(this.addChild(f),b=0;b<this.reelData.length;b++)c=new createjs.Sprite(this.symbolSprites,this.spriteMap[this.reelData[b]]),f.addChild(c),c.y=d*b+e*b;f.y=-a*(d*this.reelData.length+e*this.reelData.length),this.containers.wraps.push(f)}},b.spinInfinite=function(a,b){var c=this,d=this.setup.symbolH,e=this.setup.symbolMarginBottom,f=this.reelData.length;this.spinResultIndex=b,this.scheduleSpinStop=-1;var g=d*f+e*f;createjs.Tween.get(this).wait(a).play(createjs.Tween.get(this,{loop:!1,paused:!0}).to({y:g},this.getTime(),createjs.Ease.getElasticIn(2,5)).call(this.loopSpin)),this.stopTimeout=setTimeout(function(){c.fastStop()},this.setup.reelAnimation.duration+a)},b.loopSpin=function(){var a,b,c=this.setup.symbolH,d=this.setup.symbolMarginBottom,e=this.reelData.length;-1===this.scheduleSpinStop&&(this.y=0,a=c*e+d*e,b=createjs.Ease.linear(),createjs.Tween.get(this,{override:!0,loop:!1}).to({y:a},this.getTime(),b).call(this.loopSpin))},b.stopSpin=function(a){this.scheduleSpinStop=-2;var b=this.setup.symbolH,c=this.setup.symbolMarginBottom,d=this.reelData.length,e=b*a+c*a+(b*d+c*d),f=this.getStopTime(a);setTimeout(function(){createjs.Sound.play("reelstop1")},f-300),this.y=0,createjs.Tween.get(this,{override:!0,loop:!1}).to({y:e},f,createjs.Ease.getElasticOut(2,5)).call(this.handleSpinComplete)},b.fastStop=function(){this.scheduleSpinStop>-2&&(clearInterval(this.stopTimeout),this.stopSpin(this.spinResultIndex))},b.handleSpinComplete=function(){this.reelSpinEnd.dispatch()},b.spinSpeedIncrement=function(a){this.speedPercentage!==a&&(this.speedPercentage=a,this.scheduleSpeedChange=!0)},G.Reel=createjs.promote(a,"Container")}();var G=G||{};!function(){"use strict";var a=function(){this.GameComponent_constructor()},b=createjs.extend(a,G.GameComponent);b.constructor=a,b.symbolSprites=null,b.reelsData=[[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]],b.reels=[],b.reelMap=null,b.reelsSpinning=0,b.init=function(a,b,c){this.GameComponent_init(a,b),this.reelsMap=a.reelMap,this.symbolSprites=c,this.initDomEvents(),a.reelAnimation.shuffleReels&&this.shuffleReels()},b.shuffleReels=function(){var a,b=this.reelsData.length;for(a=0;b>a;a++)this.shuffle(this.reelsData[a])},b.shuffle=function(a){for(var b,c,d=a.length;0!==d;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a},b.drawReels=function(){var a,b,c=this.reelsData.length,d=this.setup.symbolW,e=this.setup.reelMarginRight;for(a=0;c>a;a++)b=new G.Reel,b.init(this.setup,this.symbolSprites,this.reelsData[a]),this.addChild(b),b.drawReel(),this.reels.push(b),b.x=d*a+e*a},b.spinReels=function(){var a,b,c,d=this,e=this.reels.length,f=this.setup.reelAnimation.delay.max;createjs.Sound.play("spin1"),this.signalDispatcher.reelSpinStart.dispatch();var g=function(a){return d.setup.reelAnimation.delay.random===!0?Math.random()*f:d.setup.reelAnimation.delay.sequenced===!0?f/d.reels.length*a:void 0};if(0===this.reelsSpinning)for(a=0;e>a;a++)c=g(a),b=this.reels[a],b.spinInfinite(c,-2),b.reelSpinEnd.add(this.reelSpinEnd,this),this.reelsSpinning++;else for(a=0;e>a;a++)b=this.reels[a],b.fastStop()},b.updateSpinSpeed=function(a){var b,c,d=this.reels.length;for(b=0;d>b;b++)c=this.reels[b],c.spinSpeedIncrement(a/100)},b.reelSpinEnd=function(){0===--this.reelsSpinning&&this.signalDispatcher.reelSpinComplete.dispatch()},b.initDomEvents=function(){var a=this;$("#gasPedal").on("input",function(b){var c=$(b.target).val();a.updateSpinSpeed(c)})},G.ReelsComponent=createjs.promote(a,"GameComponent")}(),this.G=this.G||{},function(){"use strict";var a=function(){},b=a.prototype;b.constructor=a,b.signalDispatcher=null,b.init=function(a){this.signalDispatcher=a},G.ServerInterface=a}();var G=G||{};!function(){"use strict";var a=function(){},b=a.prototype;b.constructor=a,b.gameComponents=null,b.setup=null,b.reelSpinComplete=new signals.Signal,b.reelSpinStart=new signals.Signal,b.init=function(a,b){this.setup=a,this.gameComponents=b,this.commandQueue=new G.CommandQueue,this.commandQueue.init(a,b),this.reelSpinStart.add(this.handleReelSpinStart,this),this.reelSpinComplete.add(this.handleReelSpinComplete,this)},b.handleReelSpinStart=function(){var a=_.find(this.gameComponents,function(a){return a instanceof G.WinLinesComponent});a.hideWinLines()},b.handleReelSpinComplete=function(){this.commandQueue.setupQueue(),this.commandQueue.play()},G.SignalDispatcher=a}();var G=G||{};!function(){"use strict";var a=function(){this.Container_constructor()},b=createjs.extend(a,createjs.Container);b.constructor=a,b.winLineSquares=[0,0,0,0,0],b.symbolLocations=[1,1,1,1,1],b.setup=null,b.color="#ff0000",b.thickness=5,b.glowFilter=null,b.dropshadowfilter=null,b.drawComplete=new signals.Signal,b.init=function(a,b,c){this.setup=a,this.winLineSquares=b||this.winLineSquares,this.symbolLocations=c||this.symbolLocations,this.setupDropShadow(),this.setupGlowFilter()},b.drawComponent=function(){var a=this.setup.symbolW,b=this.setup.symbolH,c=this.setup.symbolMarginBottom,d=this.setup.reelMarginRight,e=new createjs.Shape,f=e.graphics;f.setStrokeStyle(this.thickness),f.beginStroke(this.color),f.moveTo(0,0),this.addChild(e);var g,h=this.symbolLocations.length;for(g=0;h>g;g++){var i=g*a+g*d+this.thickness/2,j=this.symbolLocations[g]*b+this.symbolLocations[g]*c+this.thickness/2,k=a-this.thickness,l=b-this.thickness+1,m={x:i+k+2*this.thickness,y:j+l/2};0===g&&f.moveTo(i,m.y),h-1>g?1===this.winLineSquares[g]?(f.drawRect(i,j,k,l),this.symbolLocations[g+1]===this.symbolLocations[g]&&f.moveTo(i+k,j+l/2),this.symbolLocations[g+1]===this.symbolLocations[g]+1&&(f.moveTo(i+k,j+l),m.y=j+l+2*this.thickness),this.symbolLocations[g+1]===this.symbolLocations[g]-1):(f.lineTo(i+a/2,m.y),this.symbolLocations[g+1]===this.symbolLocations[g],this.symbolLocations[g+1]===this.symbolLocations[g]+1&&(m.y=j+b),this.symbolLocations[g+1]===this.symbolLocations[g]-1&&(m.y=j-this.thickness/2)):g===h-1&&(1===this.winLineSquares[g]?(f.drawRect(i,j,k,l),f.moveTo(m.x,m.y)):(f.lineTo(i+a/2,m.y),m.x=i+a-2)),f.lineTo(m.x,m.y)}if(this.setup.enableWinLineShadows){var n=[];n.push(this.dropShadow),n.push(this.glowFilter),e.filters=n,e.setBounds(0,0,this.setup.bezelW,this.setup.bezelH);var o=e.getBounds();e.cache(o.x,o.y,o.width,o.height)}this.drawComplete.dispatch()},b.setupDropShadow=function(){var a=1,b=90,c=16777215,d=1,e=2,f=2,g=2,h=2,i=!0,j=!1,k=!1;this.dropShadow=new createjs.DropShadowFilter(a,b,c,d,e,f,g,h,i,j,k)},b.setupGlowFilter=function(){var a=0,b=.7,c=2,d=2,e=5,f=2,g=!1,h=!1;this.glowFilter=new createjs.GlowFilter(a,b,c,d,e,f,g,h)},G.WinLine=createjs.promote(a,"Container")}();var G=G||{};!function(){"use strict";var a=function(){this.GameComponent_constructor()},b=createjs.extend(a,G.GameComponent);b.constructor=a,b.winLines=[],b.numLinesTotoal=0,b.numLinesDrawn=0,b.el=null,b.loadPercentage=0,b.init=function(a,b){this.GameComponent_init(a,b)},b.drawComponent=function(){var a,b=this.setup.bezelMarginL,c=this.setup.bezelMarginT,d=this.setup.winLines,e=this.numLinesTotal=d.length;if(this.el=document.querySelector("#preloader"),this.setup.enableShadowsOnDesktop){var f=[];f.push(this.dropShadow),f.push(this.glowFilter)}for(a=0;e>a;a++){var g=new G.WinLine;g.init(this.setup,[0,0,0,0,0],d[a].data),g.color=d[a].color,this.addChild(g),g.drawComplete.add(this.onWinLineDrawn,this),g.drawComponent(),g.x=b,g.y=c,g.visible=!1,this.winLines.push(g)}},b.onWinLineDrawn=function(){++this.numLinesDrawn,this.numLinesDrawn===this.numLinesTotal&&(this.el.style.visibility="hidden")},b.hideWinLines=function(){var a=function(a){a.visible=!1};_.each(this.winLines,a)},b.showWinLineByIndexes=function(a){var b,c=a.length;for(b=0;c>b;b++)this.winLines[a[b]].visible=!0},G.WinLinesComponent=createjs.promote(a,"GameComponent")}();var G=G||{};!function(){"use strict";var a=function(){this.Command_constructor()},b=createjs.extend(a,G.Command);b.constructor=a,b.winLineIndexes=[0],b.init=function(a,b,c){this.Command_init(a,b),this.winLineIndexes=c||this.winLineIndexes},b.execute=function(){this.gameComponent.hideWinLines(),this.gameComponent.showWinLineByIndexes(this.winLineIndexes)},G.WinLineCommand=createjs.promote(a,"Command")}();